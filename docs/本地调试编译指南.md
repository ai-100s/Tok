# æœ¬åœ°è°ƒè¯•å’Œç¼–è¯‘æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨æœ¬åœ°ç¯å¢ƒä¸­è°ƒè¯•å’Œç¼–è¯‘é›†æˆäº†è¿œç¨‹è½¬å½•æ¨¡å‹ï¼ˆOpenAIï¼‰çš„ Tok é¡¹ç›®ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼Œæ‚¨å¯ä»¥æˆåŠŸè¿è¡Œæ–°åŠŸèƒ½å¹¶è¿›è¡Œå¼€å‘è°ƒè¯•ã€‚

## ğŸ“‹ ç¯å¢ƒè¦æ±‚æ£€æŸ¥

### 1. ç³»ç»Ÿè¦æ±‚
- **macOS**: 15.0+ (Sequoia)
- **Xcode**: 16.4+ 
- **Swift**: 6.1.2+
- **å¤„ç†å™¨**: Apple Silicon (M1/M2/M3) æ¨è

### 2. éªŒè¯å½“å‰ç¯å¢ƒ

```bash
# æ£€æŸ¥ Xcode ç‰ˆæœ¬
xcodebuild -version

# æ£€æŸ¥ Swift ç‰ˆæœ¬  
swift --version

# æ£€æŸ¥ macOS ç‰ˆæœ¬
sw_vers
```

é¢„æœŸè¾“å‡ºï¼š
```
Xcode 16.4
Build version 16F6

Apple Swift version 6.1.2 (swiftlang-6.1.2.1.2 clang-1700.0.13.5)
Target: arm64-apple-macosx15.0

ProductName:		macOS
ProductVersion:		15.x.x
```

## ğŸ”§ é¡¹ç›®æ–‡ä»¶é›†æˆæ­¥éª¤

### 1. æ–°æ–‡ä»¶çŠ¶æ€æ£€æŸ¥

ç¡®è®¤ä»¥ä¸‹æ–°æ–‡ä»¶å·²åˆ›å»ºï¼š

```
Hex/Models/TranscriptionModels.swift          âœ… å·²åˆ›å»º
Hex/Clients/OpenAITranscriptionClient.swift  âœ… å·²åˆ›å»º
```

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
```
Hex/Models/HexSettings.swift                  âœ… å·²ä¿®æ”¹
Hex/Clients/TranscriptionClient.swift         âœ… å·²ä¿®æ”¹  
Hex/Features/Settings/SettingsView.swift      âœ… å·²ä¿®æ”¹
Hex/Features/Settings/SettingsFeature.swift   âœ… å·²ä¿®æ”¹
```

### 2. æ·»åŠ æ–°æ–‡ä»¶åˆ° Xcode é¡¹ç›®

**é‡è¦ï¼š** æ–°åˆ›å»ºçš„æ–‡ä»¶éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ° Xcode é¡¹ç›®ä¸­ã€‚

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Xcode GUI
1. åœ¨ Xcode ä¸­æ‰“å¼€ `Hex.xcodeproj`
2. åœ¨é¡¹ç›®å¯¼èˆªå™¨ä¸­å³é”®ç‚¹å‡» `Hex/Models` æ–‡ä»¶å¤¹
3. é€‰æ‹© "Add Files to 'Hex'"
4. å¯¼èˆªåˆ° `Hex/Models/TranscriptionModels.swift`
5. ç¡®ä¿ "Target Membership" é€‰ä¸­ "Tok"
6. ç‚¹å‡» "Add"

é‡å¤ä»¥ä¸Šæ­¥éª¤æ·»åŠ  `OpenAITranscriptionClient.swift` åˆ° `Hex/Clients` æ–‡ä»¶å¤¹ã€‚

#### æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡ŒéªŒè¯

```bash
cd /Users/sailfish/CodeProject/Tok

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la Hex/Models/TranscriptionModels.swift
ls -la Hex/Clients/OpenAITranscriptionClient.swift

# éªŒè¯æ–‡ä»¶è¯­æ³•
swiftc -parse Hex/Models/TranscriptionModels.swift
swiftc -parse Hex/Clients/OpenAITranscriptionClient.swift
```

## ğŸ—ï¸ ç¼–è¯‘å’Œæ„å»º

### 1. æ¸…ç†å’Œé‡æ–°æ„å»º

```bash
cd /Users/sailfish/CodeProject/Tok

# æ¸…ç†æ„å»ºç¼“å­˜
xcodebuild -scheme Tok -configuration Debug clean

# é‡æ–°è§£æ Swift Package ä¾èµ–
xcodebuild -resolvePackageDependencies

# æ‰§è¡Œå®Œæ•´æ„å»º
xcodebuild -scheme Tok -configuration Debug build
```

### 2. å¤„ç†å¸¸è§ç¼–è¯‘é”™è¯¯

#### é”™è¯¯Aï¼šå®æƒé™é—®é¢˜
```
error: Macro "DependenciesMacrosPlugin" from package "swift-dependencies" must be enabled before it can be used
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. åœ¨ Xcode ä¸­æ‰“å¼€é¡¹ç›®
2. é€‰æ‹©é¡¹ç›®æ ¹èŠ‚ç‚¹ï¼Œç‚¹å‡» "Trust & Enable" æŒ‰é’®
3. æˆ–è€…åœ¨ Xcode èœå•ï¼šProduct â†’ Trust Macro Plugins

#### é”™è¯¯Bï¼šæ–‡ä»¶æœªæ‰¾åˆ°
```
error: No such file or directory: 'TranscriptionModels.swift'
```

**è§£å†³æ–¹æ¡ˆï¼š**
ç¡®ä¿æ–°æ–‡ä»¶å·²æ­£ç¡®æ·»åŠ åˆ° Xcode é¡¹ç›®å¹¶è®¾ç½®äº†æ­£ç¡®çš„ Target Membershipã€‚

#### é”™è¯¯Cï¼šä¾èµ–å†²çª
```
error: Package resolution failed
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åˆ é™¤æ´¾ç”Ÿæ•°æ®
rm -rf ~/Library/Developer/Xcode/DerivedData/Hex-*

# é‡ç½® Swift Package ç¼“å­˜
xcodebuild -resolvePackageDependencies -clonedSourcePackagesDirPath ~/Library/Developer/Xcode/DerivedData/
```

### 3. æˆåŠŸç¼–è¯‘éªŒè¯

æˆåŠŸç¼–è¯‘åï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
```
** BUILD SUCCEEDED **
```

## ğŸ” è°ƒè¯•é…ç½®

### 1. è®¾ç½®è°ƒè¯•æ–­ç‚¹

åœ¨ä»¥ä¸‹å…³é”®ä½ç½®è®¾ç½®æ–­ç‚¹ï¼š

**TranscriptionClient.swift:**
```swift
// ç¬¬ 332 è¡Œ - æ¨¡å‹ç±»å‹è§£æ
if let modelType = TranscriptionModelType(rawValue: model) {

// ç¬¬ 361 è¡Œ - æä¾›å•†è·¯ç”±
switch modelType.provider {

// ç¬¬ 380 è¡Œ - OpenAI å®¢æˆ·ç«¯è°ƒç”¨
let openaiClient = OpenAITranscriptionClient(apiKey: settings.openaiAPIKey)
```

**OpenAITranscriptionClient.swift:**
```swift
// ç¬¬ 125 è¡Œ - API è¯·æ±‚å‘é€
print("[OpenAI] Sending transcription request for model: \(model.displayName)")

// ç¬¬ 137 è¡Œ - å“åº”å¤„ç†
if httpResponse.statusCode != 200 {
```

### 2. å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨è°ƒè¯•æ„å»ºä¸­ï¼Œç¡®ä¿ä»¥ä¸‹æ—¥å¿—è¾“å‡ºï¼š

```swift
// åœ¨ TranscriptionClient ä¸­æŸ¥æ‰¾è¿™äº›æ—¥å¿—
print("[TranscriptionClientLive] transcribe - checking model...")
print("[OpenAI] API key test failed...")
```

### 3. Xcode è°ƒè¯•é…ç½®

1. é€‰æ‹© "Tok" scheme
2. è®¾ç½®æ–­ç‚¹
3. æŒ‰ `Cmd+R` è¿è¡Œ
4. åœ¨ Debug Area æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

## ğŸ§ª åŠŸèƒ½æµ‹è¯•æŒ‡å—

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•æœ¬åœ°æ¨¡å‹ï¼ˆç¡®ä¿å‘åå…¼å®¹ï¼‰
1. å¯åŠ¨åº”ç”¨
2. æ‰“å¼€è®¾ç½® â†’ è½¬å½•æ¨¡å‹
3. é€‰æ‹©ä»»ä¸€æœ¬åœ° WhisperKit æ¨¡å‹
4. å½•åˆ¶ä¸€æ®µè¯­éŸ³æµ‹è¯•è½¬å½•åŠŸèƒ½

#### æµ‹è¯•è¿œç¨‹æ¨¡å‹é€‰æ‹©
1. åœ¨è®¾ç½®ä¸­é€‰æ‹© OpenAI æ¨¡å‹
2. éªŒè¯æ˜¯å¦æ˜¾ç¤º API å¯†é’¥é…ç½®ç•Œé¢
3. è¾“å…¥æµ‹è¯• API å¯†é’¥
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®

### 2. API å¯†é’¥æµ‹è¯•

#### æœ‰æ•ˆ API å¯†é’¥æµ‹è¯•
```bash
# æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆå®é™…éœ€è¦çœŸå® API å¯†é’¥ï¼‰
# 1. è·å– OpenAI API å¯†é’¥ï¼šhttps://platform.openai.com/api-keys
# 2. åœ¨è®¾ç½®ä¸­è¾“å…¥å¯†é’¥
# 3. ç‚¹å‡»"æµ‹è¯•è¿æ¥"
# 4. éªŒè¯æ˜¾ç¤ºç»¿è‰²å¯¹å‹¾å’Œ"Valid"çŠ¶æ€
```

#### æ— æ•ˆ API å¯†é’¥æµ‹è¯•
1. è¾“å…¥æ— æ•ˆçš„ API å¯†é’¥ï¼ˆå¦‚ "test-invalid-key"ï¼‰
2. ç‚¹å‡»"æµ‹è¯•è¿æ¥"
3. éªŒè¯æ˜¾ç¤ºçº¢è‰² X å’Œ"Invalid"çŠ¶æ€

### 3. è½¬å½•åŠŸèƒ½æµ‹è¯•

#### OpenAI è½¬å½•æµ‹è¯•
1. é…ç½®æœ‰æ•ˆçš„ OpenAI API å¯†é’¥
2. é€‰æ‹© OpenAI æ¨¡å‹ï¼ˆgpt-4o-mini-transcribe æˆ– gpt-4o-transcribeï¼‰
3. å½•åˆ¶çŸ­è¯­éŸ³ï¼ˆå»ºè®® < 10 ç§’ï¼Œé¿å…äº§ç”Ÿè´¹ç”¨ï¼‰
4. éªŒè¯è½¬å½•ç»“æœè´¨é‡

#### é”™è¯¯å¤„ç†æµ‹è¯•
1. **æ— ç½‘ç»œè¿æ¥**ï¼šæ–­å¼€ç½‘ç»œï¼Œæµ‹è¯• OpenAI æ¨¡å‹
2. **æ–‡ä»¶è¿‡å¤§**ï¼šæµ‹è¯• 25MB+ çš„éŸ³é¢‘æ–‡ä»¶
3. **API é…é¢**ï¼šä½¿ç”¨è€—å°½é…é¢çš„ API å¯†é’¥

## ğŸš¨ æ•…éšœæ’é™¤æŒ‡å—

### é—®é¢˜1ï¼šç¼–è¯‘å¤±è´¥ - æ–‡ä»¶æœªæ‰¾åˆ°

**ç—‡çŠ¶ï¼š**
```
error: Cannot find 'TranscriptionModelType' in scope
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ `TranscriptionModels.swift` å·²æ·»åŠ åˆ°é¡¹ç›®
2. æ£€æŸ¥æ–‡ä»¶çš„ Target Membership è®¾ç½®
3. æ¸…ç†å¹¶é‡æ–°æ„å»ºé¡¹ç›®

**éªŒè¯å‘½ä»¤ï¼š**
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®ç¼–è¯‘
swiftc -parse Hex/Models/TranscriptionModels.swift
```

### é—®é¢˜2ï¼šè¿è¡Œæ—¶å´©æºƒ - API å¯†é’¥

**ç—‡çŠ¶ï¼š**
åº”ç”¨åœ¨é€‰æ‹© OpenAI æ¨¡å‹æ—¶å´©æºƒ

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `HexSettings.swift` ä¸­çš„ OpenAI é…ç½®å­—æ®µ
2. éªŒè¯è®¾ç½®åºåˆ—åŒ–/ååºåˆ—åŒ–æ­£å¸¸å·¥ä½œ
3. é‡ç½®åº”ç”¨è®¾ç½®ï¼ˆåˆ é™¤ `~/Library/Application Support/com.kitlangton.Hex/`ï¼‰

### é—®é¢˜3ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥

**ç—‡çŠ¶ï¼š**
```
[OpenAI] API key test failed: Error Domain=NSURLErrorDomain Code=-1009
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. éªŒè¯é˜²ç«å¢™è®¾ç½®
3. ç¡®è®¤ API å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆä»¥ "sk-" å¼€å¤´ï¼‰

### é—®é¢˜4ï¼šUI æ˜¾ç¤ºå¼‚å¸¸

**ç—‡çŠ¶ï¼š**
è®¾ç½®ç•Œé¢æ˜¾ç¤ºä¸æ­£å¸¸æˆ–ç¼ºå°‘å…ƒç´ 

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `SettingsView.swift` çš„ä¿®æ”¹æ˜¯å¦æ­£ç¡®
2. éªŒè¯æ‰€æœ‰ UI ç»„ä»¶çš„å¼•ç”¨
3. é‡å¯ Xcode å’Œåº”ç”¨

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 1. å†…å­˜ä½¿ç”¨ç›‘æ§

åœ¨ Xcode ä¸­å¯ç”¨ Memory Graph Debuggerï¼š
1. è¿è¡Œåº”ç”¨
2. ç‚¹å‡» Debug Memory Graph æŒ‰é’®
3. æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼

### 2. ç½‘ç»œè¯·æ±‚ç›‘æ§

ä½¿ç”¨ Xcode Network Profilerï¼š
1. Product â†’ Profile
2. é€‰æ‹© Network template
3. æµ‹è¯• OpenAI API è°ƒç”¨

### 3. æ—¥å¿—åˆ†æ

å…³é”®æ—¥å¿—æŸ¥çœ‹ä½ç½®ï¼š
```bash
# åº”ç”¨æ—¥å¿—
tail -f ~/Library/Logs/Tok/tok.log

# ç³»ç»Ÿæ§åˆ¶å°
log show --predicate 'process == "Tok"' --last 10m
```

## ğŸ¯ å¼€å‘å·¥ä½œæµå»ºè®®

### 1. æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. æ¸…ç†å’Œæ„å»º
xcodebuild clean build

# 3. è¿è¡Œæµ‹è¯•
xcodebuild test -scheme Tok

# 4. å¯åŠ¨è°ƒè¯•
open Hex.xcodeproj
```

### 2. æäº¤å‰æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æ–°æ–‡ä»¶å·²æ·»åŠ åˆ° Xcode é¡¹ç›®
- [ ] ç¼–è¯‘æˆåŠŸæ— è­¦å‘Š
- [ ] åŸºæœ¬åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] API å¯†é’¥æµ‹è¯•æ­£å¸¸
- [ ] å‘åå…¼å®¹æ€§éªŒè¯
- [ ] ä»£ç æ ¼å¼åŒ–å®Œæˆ

### 3. ç‰ˆæœ¬æ§åˆ¶å»ºè®®

```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/openai-transcription

# æäº¤æ›´æ”¹
git add .
git commit -m "Add OpenAI transcription integration"

# æ¨é€åˆ†æ”¯
git push origin feature/openai-transcription
```

## ğŸ“ æ”¯æŒå’Œèµ„æº

### ç›¸å…³æ–‡æ¡£
- [OpenAI Speech-to-Text API](https://platform.openai.com/docs/guides/speech-to-text)
- [WhisperKit æ–‡æ¡£](https://github.com/argmaxinc/WhisperKit)
- [Composable Architecture æŒ‡å—](https://github.com/pointfreeco/swift-composable-architecture)

### è°ƒè¯•èµ„æº
- Xcode å®˜æ–¹è°ƒè¯•æŒ‡å—
- Swift Package Manager æ–‡æ¡£
- macOS åº”ç”¨å¼€å‘æŒ‡å—

---

**æ³¨æ„ï¼š** æœ¬æŒ‡å—åŸºäºå½“å‰é¡¹ç›®ç»“æ„å’Œå®ç°ã€‚å¦‚é‡åˆ°å…·ä½“é—®é¢˜ï¼Œè¯·å‚è€ƒé”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—è¾“å‡ºè¿›è¡Œé’ˆå¯¹æ€§æ’æŸ¥ã€‚